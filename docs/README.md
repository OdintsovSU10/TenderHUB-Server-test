# Индекс документации TenderHUB

Эта директория содержит полную документацию для всех страниц и функций системы управления тендерами TenderHUB.

## Обзор документации

Все файлы документации следуют единой структуре:
- **Обзор**: Назначение страницы и маршрут
- **Возможности**: Список основных функций
- **Компоненты интерфейса**: Описание компонентов
- **Пользовательские сценарии**: Пошаговые сценарии работы
- **Модель данных**: Таблицы и схемы базы данных
- **API эндпоинты**: Запросы Supabase
- **Расчеты**: Формулы и логика (если применимо)
- **Связанные страницы**: Ссылки на связанный функционал
- **Скриншоты**: Место для визуальных справок
- **Технические заметки**: Детали реализации
- **Будущие улучшения**: Планируемые доработки

## Основные файлы документации

### Пользовательские страницы

#### 1. **CLIENT_POSITIONS.md** (13 KB)
**Маршрут**: `/positions`
**Назначение**: Иерархическое управление позициями BOQ

**Ключевые темы**:
- Выбор тендера
- Многоуровневая иерархия
- Система дополнительных работ (ДОП)
- Inline редактирование
- Функции копирования/вставки
- Экспорт в Excel

#### 2. **POSITION_ITEMS.md** (18 KB)
**Маршрут**: `/positions/:positionId/items`
**Назначение**: Управление элементами BOQ (работы и материалы)

**Ключевые темы**:
- Интерфейс мгновенного добавления
- Система расчета цен (3 поля цен)
- Связывание материалов с работами
- Коэффициенты пересчета
- Inline формы редактирования
- Вставка шаблонов

#### 3. **LIBRARY.md** (18 KB)
**Маршрут**: `/library`
**Назначение**: Управление библиотекой работ и материалов

**Ключевые темы**:
- Интерфейс с двумя вкладками (Материалы/Работы)
- Inline редактирование
- Поиск и пагинация
- Цветовая кодировка типов и единиц
- CRUD операции
- Интеграция с библиотекой наименований

#### 4. **TEMPLATES.md** (19 KB)
**Маршрут**: `/library/templates`
**Назначение**: Переиспользуемые наборы работ и материалов

**Ключевые темы**:
- Универсальная таблица элементов (паттерн дискриминатора)
- Создание и редактирование шаблонов
- Иерархическая структура
- Вставка в позиции
- Система фильтрации

#### 5. **FINANCIAL_INDICATORS.md** (16 KB)
**Маршрут**: `/financial-indicators`
**Назначение**: Анализ 15 финансовых показателей

**Ключевые темы**:
- Выбор тендера
- Два режима отображения (графики/таблицы)
- Визуализация Chart.js
- Прямые и коммерческие затраты
- Экспорт в Excel

#### 6. **COMMERCE_PAGE.md** (8 KB)
**Маршрут**: `/commerce`
**Назначение**: Коммерческий анализ на уровне позиций

**Ключевые темы**:
- Коммерческие расчеты
- Отслеживание прибыли
- Итоги по позициям
- Разбивка затрат

#### 7. **CONSTRUCTION_COSTS.md** (17 KB)
**Две документированные страницы**:
- `/admin/construction_cost` - Справочник затрат
- `/costs` - Анализ затрат на строительство

**Ключевые темы**:
- 3-уровневая иерархия
- Управление структурой затрат
- Анализ по тендерам
- Управление объемами
- Переключение прямых/коммерческих затрат
- Экспорт в Excel (двойные листы)

### Административные страницы

#### 8. **NOMENCLATURES.md** (17 KB)
**Маршрут**: `/admin/nomenclatures`
**Назначение**: Управление библиотеками наименований и единицами измерения

**Ключевые темы**:
- Библиотека наименований материалов
- Библиотека наименований работ
- Единицы измерения
- CRUD операции
- Валидация использования
- Нормализация базы данных

#### 9. **TENDERS.md** (18 KB)
**Маршрут**: `/admin/tenders`
**Назначение**: Управление тендерами и загрузка BOQ

**Ключевые темы**:
- CRUD операции тендеров
- Мастер загрузки BOQ из Excel (3 шага)
- Сопоставление колонок
- Контроль версий
- Сопоставление версий
- Меню действий

#### 10. **MARKUP_CONSTRUCTOR.md** (20 KB)
**Маршрут**: `/admin/markup_constructor`
**Назначение**: Конфигурация тактик расчета наценок

**Ключевые темы**:
- Управление тактиками наценок
- Последовательности параметров (6 типов)
- Drag-and-drop упорядочивание
- Базовые проценты
- Распределение ценообразования
- Логика последовательного выполнения

#### 11. **SETTINGS.md** (17 KB)
**Маршрут**: `/settings`
**Назначение**: Пользовательские настройки и кастомизация

**Ключевые темы**:
- Выбор семейства шрифтов (8 вариантов)
- Контроль размера шрифта (10-20px)
- Настройка высоты строки
- Межбуквенный интервал
- Компактный режим
- Сохранение в localStorage
- Предпросмотр в реальном времени

### Системная документация

#### 12. **DASHBOARD_DESIGN_SYSTEM.md** (8 KB)
Паттерны дизайна дашборда и система сетки карточек

#### 13. **DASHBOARD_REDESIGN_SUMMARY.md** (12 KB)
Документация редизайна дашборда

#### 14. **DASHBOARD_VISUAL_REFERENCE.md** (19 KB)
Визуальный справочник дизайна дашборда

#### 15. **DESIGN_TOKENS.md** (11 KB)
Токены и переменные дизайн-системы

#### 16. **IMPORT_COST_CATEGORIES.md** (4 KB)
Документация импорта категорий затрат

#### 17. **IMPORT_VALIDATION_AND_SQL.md** (5 KB)
Валидация импорта и генерация SQL

#### 18. **MARKUP_CALCULATOR.md** (10 KB)
Документация расчета наценок

## Быстрая навигация

### По функциональности

**Управление тендерами**:
- [Tenders](TENDERS.md) - CRUD тендеров и загрузка BOQ
- [Client Positions](CLIENT_POSITIONS.md) - Иерархия позиций
- [Position Items](POSITION_ITEMS.md) - Работы и материалы
- [Dashboard](DASHBOARD_DESIGN_SYSTEM.md) - Обзор

**Управление библиотеками**:
- [Library](LIBRARY.md) - Библиотеки работ и материалов
- [Templates](TEMPLATES.md) - Переиспользуемые наборы
- [Nomenclatures](NOMENCLATURES.md) - Библиотеки наименований

**Финансовый анализ**:
- [Commerce](COMMERCE_PAGE.md) - Анализ на уровне позиций
- [Financial Indicators](FINANCIAL_INDICATORS.md) - Показатели тендера
- [Construction Costs](CONSTRUCTION_COSTS.md) - Анализ затрат

**Конфигурация**:
- [Markup Constructor](MARKUP_CONSTRUCTOR.md) - Тактики наценок
- [Settings](SETTINGS.md) - Пользовательские настройки

### По типу пользователя

**Все пользователи**:
- Позиции заказчика
- Элементы позиций
- Библиотека
- Шаблоны
- Коммерция
- Финансовые показатели
- Затраты на строительство (Анализ)
- Настройки

**Администраторы**:
- Тендеры
- Номенклатуры
- Конструктор наценок
- Затраты на строительство (Справочник)

## Справочник таблиц базы данных

### Основные таблицы
- `tenders` - Информация о тендерах
- `client_positions` - Позиции BOQ
- `boq_items` - Работы и материалы

### Таблицы библиотек
- `materials_library` - Ценообразование материалов
- `works_library` - Ценообразование работ
- `material_names` - Библиотека наименований материалов
- `work_names` - Библиотека наименований работ
- `units` - Единицы измерения

### Таблицы шаблонов
- `templates` - Метаданные шаблонов
- `template_items` - Универсальная таблица элементов (работы + материалы)

### Таблицы наценок
- `markup_tactics` - Стратегии наценок
- `markup_parameters` - Параметры расчета
- `tender_markup_percentage` - Проценты по тендерам

### Таблицы затрат
- `cost_categories` - Структура категорий затрат
- `detail_cost_categories` - Детальные категории
- `construction_cost_volumes` - Объемы по тендерам

## Общие паттерны

### CRUD операции
Все страницы управления сущностями следуют схожим паттернам:
1. Табличное представление с поиском и пагинацией
2. Модальное окно/форма добавления
3. Inline или модальное редактирование
4. Удаление с подтверждением
5. Интеграция с Supabase

### Inline редактирование
Стандартный паттерн:
1. Клик для редактирования (или кнопка Edit)
2. Строка/ячейка входит в режим редактирования
3. Сохранение (клавиша Enter или кнопка Save)
4. Отмена (клавиша Escape или кнопка Cancel)
5. Автообновление при сохранении

### Поиск и фильтрация
Общая реализация:
1. Поле поиска (в реальном времени или с отложенным вводом)
2. Фильтрация на клиенте
3. Кнопка очистки поиска
4. Сохранение пагинации

### Паттерны навигации
Единообразная навигация:
1. Хлебные крошки или кнопки назад
2. URL параметры для контекста
3. Прокрутка к элементу и подсветка при возврате
4. Поддержка глубоких ссылок

## Поток данных

### Типичный поток
```
Тендеры → Позиции заказчика → Элементы позиций (BOQ Items)
                                    ↓
                              Применение наценки
                                    ↓
                        Коммерция/Финансовый анализ
                                    ↓
                          Затраты на строительство
```

### Поток расчета цен
```
Библиотека (initial_price)
    ↓
BOQ Item (скопирован initial_price)
    ↓
Применение тактики наценки (последовательные параметры)
    ↓
Рост материалов (только материалы)
    ↓
Расчетная цена (calculated_price)
    ↓
Итоговая цена (calculated_price × quantity)
```

## Ключевые концепции

### Иерархические структуры
- **Позиции заказчика**: Самоссылающаяся структура с `parent_id`
- **Категории затрат**: 3-уровневая структура
- **Шаблоны**: Родительско-дочерние связи работ и материалов

### Поля цен
- **initial_price**: Базовая цена из библиотеки
- **calculated_price**: После применения наценки
- **total_price**: Цена × количество

### Типы элементов (ENUM)
- `мат` - Материал
- `раб` - Работа
- `суб-мат` - Субподрядный материал
- `суб-раб` - Субподрядная работа
- `мат-комп.` - Компонентный материал
- `раб-комп.` - Компонентная работа

### Дополнительные работы (ДОП)
- Создаются из обычных позиций
- Десятичная нумерация (5.1, 5.2 и т.д.)
- Визуальные маркеры (оранжевый тег, отступ)
- Не могут быть вложенными

### Обработка валют
- Четыре валюты: RUB, USD, EUR, CNY
- Курсы хранятся в таблице `tenders`
- Автоматическая конвертация в RUB для расчетов

## Ограничения по размеру файлов

**ВАЖНО**: Все файлы должны быть ≤ 600 строк

**Текущие нарушения**:
- `MaterialsTab.tsx` - ~970 строк (требует рефакторинга)
- `WorksTab.tsx` - ~770 строк (требует рефакторинга)

**Рекомендуемый подход**:
- Выделение компонентов в отдельные файлы
- Создание пользовательских хуков
- Использование barrel exports
- Модуляризация по функциям

## Тестирование

### Playwright тесты
Расположены в директории `./tests/`:
- Тесты потока коммерции
- Проверка расчета наценок
- Тесты управления позициями
- Тесты загрузки BOQ

**Запуск тестов**:
```bash
npx playwright test
npx playwright test --ui
```

## Внесение вклада в документацию

При добавлении новых функций:
1. Создать или обновить соответствующий .md файл
2. Следовать существующей структуре
3. Включить все разделы (Обзор, Возможности и т.д.)
4. Добавить примеры кода где полезно
5. Ссылаться на связанные страницы
6. Обновить этот README индекс

## Стандарты документации

### Форматирование Markdown
- Использовать заголовки в стиле ATX (#, ##, ###)
- Блоки кода с указанием языка
- Таблицы для сравнений
- Списки для функций и шагов
- Жирный текст для выделения
- Код для имен полей и значений

### Примеры кода
- TypeScript для определений типов
- SQL для схем базы данных
- TSX для примеров компонентов
- CSS для примеров стилей

### Структура
- Начинать с Обзора
- Группировать связанный контент
- Использовать единообразные названия разделов
- Включать примеры
- Заканчивать будущими улучшениями

## Информация о версии

**Версия документации**: 1.0
**Последнее обновление**: 2025-11-26
**Версия TenderHUB**: Активная разработка
**Схема базы данных**: prod.sql (консолидирована)

## Связанные ресурсы

### Внешние ссылки
- [Документация Ant Design](https://ant.design/)
- [Документация React Router](https://reactrouter.com/)
- [Документация Supabase](https://supabase.com/docs)
- [Документация Chart.js](https://www.chartjs.org/)
- [Документация XLSX](https://docs.sheetjs.com/)

### Внутренние файлы
- `CLAUDE.md` - Инструкции проекта для Claude Code
- `BRANDING.md` - Дизайн-система и брендинг
- `README.md` - README проекта (корень)
- `package.json` - Зависимости и скрипты

## Поддержка

По вопросам или уточнениям:
1. Проверить соответствующий файл документации
2. Просмотреть CLAUDE.md для конвенций проекта
3. Изучить исходный код в `src/pages/`
4. Проверить схему базы данных в `supabase/schemas/prod.sql`

---

**Примечание**: Эта документация постоянно обновляется по мере добавления или изменения функций. Всегда обращайтесь к исходному коду для получения актуальных деталей реализации.
